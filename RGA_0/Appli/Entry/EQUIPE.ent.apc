{Application 'EQUIPE' logic file generated by CSPro}
PROC GLOBAL

// Pour nettoyer la table
array numeric code(99);
array string label(99);
numeric j,i;

// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function Nettoie()
	i = 0;
	do i = 0 while i <= 99 
		code(i)=notappl; 
		label(i)= ""; 
	enddo; 
end;


// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Function rech_ville()
  Nettoie() ;
  numeric t=1; i=0;
    numeric xcode=0 ;
      setfile(CARTOGRAPHIE_DICT,"../Fext/Cartographie.csdb") ;  
		     if loadcase(CARTOGRAPHIE_DICT,RGAEQ01) then
		     		code(i)=notappl; label(i)= ""; 
				for t in CARTOGRAPHIE_REC do		
					   if ID_VILLE_TERRITOIRE <> xcode then
							code(i)= ID_VILLE_TERRITOIRE;
							label(i)=strip(NOM_VILLE_TERRITOIRE);
							xcode = ID_VILLE_TERRITOIRE;
							i=i+1;
						endif;
		        enddo;
			  endif;
			close(CARTOGRAPHIE_DICT);
end;

// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Function rech_sec()
  Nettoie() ;
  numeric t=0; i=0;
        numeric xcode=0 ;
      setfile(CARTOGRAPHIE_DICT,"../Fext/Cartographie.csdb") ;  
		     if loadcase(CARTOGRAPHIE_DICT,RGAEQ01) then
		     		code(i)=notappl; label(i)= ""; 
				for t in CARTOGRAPHIE_REC do	
					if ID_VILLE_TERRITOIRE = RGAEQ02 then
					   if (ID_VILLE_TERRITOIRE*1000) + ID_CU_CR_CHEF_SEC <> xcode then
							code(i)= ID_CU_CR_CHEF_SEC;
							label(i)=strip(NOM_CU_CR_CHEF_SEC);
							xcode = (ID_VILLE_TERRITOIRE*1000) + ID_CU_CR_CHEF_SEC;
							i=i+1;
						endif;
					endif;
		        enddo;
			  endif;
			close(CARTOGRAPHIE_DICT);
end;

// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Function rech_Qtier()
  Nettoie() ;
  numeric t=0; i=0;
        numeric xcode=0 ;
      setfile(CARTOGRAPHIE_DICT,"../Fext/Cartographie.csdb") ;  
		     if loadcase(CARTOGRAPHIE_DICT,RGAEQ01) then
		     		code(i)=notappl; label(i)= ""; 
				for t in CARTOGRAPHIE_REC do	
					if (ID_VILLE_TERRITOIRE*1000) + ID_CU_CR_CHEF_SEC  = (RGAEQ02*1000) + RGAEQ03 then
					   if ((ID_VILLE_TERRITOIRE*1000) + ID_CU_CR_CHEF_SEC) * 1000 + ID_QGIGT_TECH <> xcode then
							code(i)= ID_QGIGT_TECH;
							label(i)=strip(QUARTIER_GROUPEMENT);
							xcode = ((ID_VILLE_TERRITOIRE*1000) + ID_CU_CR_CHEF_SEC) * 1000 + ID_QGIGT_TECH;
							i=i+1;
						endif;
					endif;
		        enddo;
			  endif;
			close(CARTOGRAPHIE_DICT);
end;
// ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


PROC EQUIPE_FF

PROC RGAEQ34

preproc

RGAEQ34 = getlabel(RGAEQ01_VS1,RGAEQ01);
PROC RGAEQ02


onfocus

rech_ville();

setvalueset(@getsymbol(),code,label);
setcapturetype($,1);


postproc
//	REP = codes(1);	
	do varying j = 1 until  code(j) = notappl  or j > i
		
	  if code(j) = RGAEQ02 then
	    RGAEQ35 = label(j);
		break;
	  endif;
	
	enddo;

PROC RGAEQ03


onfocus

rech_sec();

setvalueset(@getsymbol(),code,label);
setcapturetype($,1);

postproc
//	REP = codes(1);	
	do varying j = 1 until  code(j) = notappl  or j > i
		
	  if code(j) = RGAEQ03 then
	    RGAEQ36 = label(j);
		break;
	  endif;
	
	enddo;

PROC RGAEQ04

onfocus

rech_Qtier();

setvalueset(@getsymbol(),code,label);
setcapturetype($,1);


postproc
//	REP = codes(1);	
	do varying j = 1 until  code(j) = notappl  or j > i
		
	  if code(j) = RGAEQ04 then
	    RGAEQ37 = label(j);
		break;
	  endif;
	
	enddo;

PROC EQUIPE_REC000

preproc

do varying i = 0 until i > RGAEQ30
		RGAEQ10(i+1) = i + 1;
		RGAEQ11(i+1) = (RGAEQ05*10) + i;
enddo;
PROC RGAEQ10

preproc
RGAEQ10 = curocc();
PROC RGAEQ31

preproc

  if special(visualvalue($)) then
    if RGAEQ31 = notappl then RGAEQ31 = sysdate("DDMMYYYY");endif;
  endif;
PROC RGAEQ32

preproc

  if special(visualvalue($)) then
    if RGAEQ32 = notappl then RGAEQ32 = systime("HHMM");endif;
	if RGAEQ33 = notappl then RGAEQ33 = timestamp(); endif;
  endif;
